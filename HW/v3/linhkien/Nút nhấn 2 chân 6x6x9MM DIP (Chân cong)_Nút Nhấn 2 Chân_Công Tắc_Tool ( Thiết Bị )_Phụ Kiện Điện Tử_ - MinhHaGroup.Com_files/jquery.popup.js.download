!function(i){i.fn.popup=function(n){var o={animation:"fadeAndPop",animationspeed:300,closeonbackgroundclick:!0,dismissmodalclass:"close-popup-modal"},n=i.extend({},o,n);return this.each(function(){function o(){s=!1}function a(){s=!0}var e=i(this),p=parseInt(e.css("top")),t=e.height()+p,s=!1,c=i(".popup-modal-bg");0==c.length&&(c=i('<div class="popup-modal-bg" />').insertAfter(e)),e.bind("popup:open",function(){c.unbind("click.modalEvent"),i("."+n.dismissmodalclass).unbind("click.modalEvent"),s||(a(),"fadeAndPop"==n.animation&&(e.css({top:i(document).scrollTop()-t,opacity:0,visibility:"visible"}),c.fadeIn(n.animationspeed/2),e.delay(n.animationspeed/2).animate({top:i(document).scrollTop()+p+"px",opacity:1},n.animationspeed,o())),"fade"==n.animation&&(e.css({opacity:0,visibility:"visible",top:i(document).scrollTop()+p}),c.fadeIn(n.animationspeed/2),e.delay(n.animationspeed/2).animate({opacity:1},n.animationspeed,o())),"none"==n.animation&&(e.css({visibility:"visible",top:i(document).scrollTop()+p}),c.css({display:"block"}),o())),e.unbind("popup:open")}),e.bind("popup:close",function(){s||(a(),"fadeAndPop"==n.animation&&(c.delay(n.animationspeed).fadeOut(n.animationspeed),e.animate({top:i(document).scrollTop()-t+"px",opacity:0},n.animationspeed/2,function(){e.css({top:p,opacity:1,visibility:"hidden"}),o()})),"fade"==n.animation&&(c.delay(n.animationspeed).fadeOut(n.animationspeed),e.animate({opacity:0},n.animationspeed,function(){e.css({opacity:1,visibility:"hidden",top:p}),o()})),"none"==n.animation&&(e.css({visibility:"hidden",top:p}),c.css({display:"none"}))),e.unbind("popup:close")}),e.trigger("popup:open");i("."+n.dismissmodalclass).bind("click.modalEvent",function(){e.trigger("popup:close")});n.closeonbackgroundclick&&(c.css({cursor:"pointer"}),c.bind("click.modalEvent",function(){e.trigger("popup:close")})),i("body").keyup(function(i){27===i.which&&e.trigger("popup:close")})})}}(jQuery);
